{"updatedAt":"2025-10-21T11:36:22.000Z","createdAt":"2025-10-15T10:22:31.318Z","id":"zxtVEgxXnnHyjBlH","name":"RAG - Basico","active":false,"isArchived":false,"nodes":[{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.chatTrigger","typeVersion":1.1,"position":[-1808,-1728],"id":"4b1c8ab7-754e-4816-b821-5634086ea152","name":"When chat message received","webhookId":"d16eb412-9cf8-467f-825f-e930db101f16"},{"parameters":{"model":{"__rl":true,"mode":"list","value":"gpt-4.1-mini"},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[-1584,-1504],"id":"3c44db17-ad70-4bbe-846d-63a77cb6cd02","name":"OpenAI Chat Model","credentials":{"openAiApi":{"id":"9vlHLfDBsAvR6wrm","name":"OpenAi account"}}},{"parameters":{"mode":"retrieve-as-tool","toolDescription":"Usa este nodo cuando el usuario realice una consulta relacionada con condiciones de compra, mÃ©todos de pago, envÃ­os, devoluciones, promociones o cualquier aspecto legal o comercial de la tienda online.\n\nEl objetivo es recuperar el fragmento mÃ¡s relevante del documento â€œTÃ©rminos y Condiciones â€“ Mi Tienda Onlineâ€, disponible en Supabase.\n\nSi el mensaje del usuario contiene palabras clave como â€œcambioâ€, â€œdevoluciÃ³nâ€, â€œenvÃ­oâ€, â€œreembolsoâ€, â€œaceptanâ€, â€œpolÃ­ticaâ€, â€œtallaâ€, â€œfalladoâ€, â€œpromociÃ³nâ€, o â€œcÃ³mo comprarâ€, este nodo debe activarse.\n\nðŸ” Ejemplos de preguntas que deben activar este nodo:\n\nÂ¿CuÃ¡ntos dÃ­as tengo para hacer un reclamo?\n\nÂ¿QuÃ© mÃ©todos de pago aceptan?\n\nÂ¿Hacen devoluciones si me queda chico?\n\nÂ¿QuÃ© pasa si el producto llega fallado?\n\nÂ¿CuÃ¡l es su polÃ­tica de promociones?","tableName":{"__rl":true,"value":"documents","mode":"list","cachedResultName":"documents"},"topK":2,"options":{}},"type":"@n8n/n8n-nodes-langchain.vectorStoreSupabase","typeVersion":1.3,"position":[-1328,-1504],"id":"6cb8c96d-f9da-43a1-a8cf-fe8c013947c1","name":"Supabase Vector Store","credentials":{"supabaseApi":{"id":"T3nXrcPYn5GbFuxT","name":"Supabase account"}}},{"parameters":{"operation":"download","fileId":{"__rl":true,"mode":"list","value":"1hM36qt5-uP8EmWYWxXHd7WLCzWneb-WR"},"options":{}},"type":"n8n-nodes-base.googleDrive","typeVersion":3,"position":[-1840,-944],"id":"95912067-e14a-45ff-9fa1-acda9e906b36","name":"Download file","credentials":{"googleDriveOAuth2Api":{"id":"i9ySFF086TyukTDr","name":"Google Drive account Bestfranquicias"}}},{"parameters":{"mode":"insert","tableName":{"__rl":true,"value":"documents","mode":"list","cachedResultName":"documents"},"options":{}},"type":"@n8n/n8n-nodes-langchain.vectorStoreSupabase","typeVersion":1.3,"position":[-1616,-736],"id":"54babc5b-1f76-4831-af75-66a6cff9c26b","name":"Supabase Vector Store1","credentials":{"supabaseApi":{"id":"T3nXrcPYn5GbFuxT","name":"Supabase account"}}},{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.embeddingsOpenAi","typeVersion":1.2,"position":[-1216,-1264],"id":"e53e98a1-7164-4ff6-bec3-1083dbd00abe","name":"Embeddings OpenAI","credentials":{"openAiApi":{"id":"9vlHLfDBsAvR6wrm","name":"OpenAi account"}}},{"parameters":{"dataType":"binary","textSplittingMode":"custom","options":{"metadata":{"metadataValues":[{"name":"file_id","value":"={{ $('Archivos Drive').item.json.id }}"},{"name":"file_name","value":"={{ $('Archivos Drive').item.json.name }}"}]}}},"type":"@n8n/n8n-nodes-langchain.documentDefaultDataLoader","typeVersion":1.1,"position":[-1536,-496],"id":"2cc7df9e-bbed-47c6-a131-5b47d3714fc1","name":"Default Data Loader"},{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.textSplitterRecursiveCharacterTextSplitter","typeVersion":1,"position":[-1504,-304],"id":"75518803-b5a2-417f-8197-9b288ef684f2","name":"Recursive Character Text Splitter"},{"parameters":{"rules":{"values":[{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"leftValue":"={{ $('Archivos Drive').item.json.mimeType }}","rightValue":"application/vnd.openxmlformats-officedocument.wordprocessingml.document","operator":{"type":"string","operation":"equals"},"id":"9c686ab2-b1ca-4020-98b2-43bcd08dc48c"}],"combinator":"and"},"renameOutput":true,"outputKey":"docs"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"bba4ea4c-dd93-488c-bb1c-1ea44529e8e2","leftValue":"={{ $('Archivos Drive').item.json.mimeType }}","rightValue":"application/pdf","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"pdf"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"d5a7bad6-81ff-462d-b6ad-989d8947b30c","leftValue":"={{ $('Archivos Drive').item.json.mimeType }}","rightValue":"text/plain","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"txt"}]},"options":{}},"type":"n8n-nodes-base.switch","typeVersion":3.2,"position":[-2112,-960],"id":"ccf83e2f-fd7f-4ec3-a701-3a2f52fe1b19","name":"Switch"},{"parameters":{"operation":"executeQuery","query":"create table if not exists archivos (\n  id text primary key,\n  title text,\n  updated_at timestamp,\n  created_at timestamp default now()\n);","options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[-3696,-256],"id":"2bf901b7-99bf-4881-b345-7bc3baa1894f","name":"Execute a SQL query","credentials":{"postgres":{"id":"RJfYPONKqWUiJzDA","name":"Postgres account"}}},{"parameters":{"options":{"reset":"={{ $prevNode.name === 'Archivos BD' }}"}},"type":"n8n-nodes-base.splitInBatches","typeVersion":3,"position":[-3008,304],"id":"2e2ba28a-917e-4b51-b78a-2b3716c0a49a","name":"Loop Over Items"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"66966be4-4443-478c-9465-11ce7d6bdf8d","leftValue":"={{ $json.id }}","rightValue":"","operator":{"type":"string","operation":"exists","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-2528,336],"id":"e80b7372-748d-4df0-bdb6-82d8e6c96628","name":"If"},{"parameters":{"resource":"fileFolder","returnAll":true,"filter":{"folderId":{"__rl":true,"value":"1YbYAUbZFy_dZtTYc8lZ9-2UzTArTCkCU","mode":"list","cachedResultName":"RAG_Best-House","cachedResultUrl":"https://drive.google.com/drive/folders/1YbYAUbZFy_dZtTYc8lZ9-2UzTArTCkCU"}},"options":{"fields":"={{ [\"id\",\"name\",\"mimeType\",\"modifiedTime\"] }}"}},"type":"n8n-nodes-base.googleDrive","typeVersion":3,"position":[-3280,-768],"id":"fae8754b-ed1f-43e6-a25e-ba706f877630","name":"Archivos Drive","credentials":{"googleDriveOAuth2Api":{"id":"i9ySFF086TyukTDr","name":"Google Drive account Bestfranquicias"}}},{"parameters":{"operation":"select","schema":{"__rl":true,"mode":"list","value":"public"},"table":{"__rl":true,"value":"archivos","mode":"list","cachedResultName":"archivos"},"returnAll":true,"options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[-3280,304],"id":"361ee0f1-e4c6-4c94-a538-8be33cb863eb","name":"Archivos BD","credentials":{"postgres":{"id":"RJfYPONKqWUiJzDA","name":"Postgres account"}}},{"parameters":{"rule":{"interval":[{}]}},"type":"n8n-nodes-base.scheduleTrigger","typeVersion":1.2,"position":[-3936,-256],"id":"d5f1853b-9234-4475-ba85-ac4362af1023","name":"Schedule Trigger"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"f2b4f24b-3339-4e35-9182-b8d3fde3dd20","leftValue":"={{ $('Archivos Drive').item.json.mimeType }}","rightValue":"=application/pdf","operator":{"type":"string","operation":"equals"}},{"id":"1b64c784-acd5-423f-b12f-a42cbe210911","leftValue":"={{ $('Archivos Drive').item.json.mimeType }}","rightValue":"text/plain","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}},{"id":"2fee83c3-5251-46f7-a448-da2967c97035","leftValue":"={{ $('Archivos Drive').item.json.mimeType }}","rightValue":"wordprocessingml.document","operator":{"type":"string","operation":"contains"}}],"combinator":"or"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-2768,-752],"id":"b07d5c10-2f26-4758-9547-1a40950b97e9","name":"If2"},{"parameters":{"options":{"reset":"={{ $prevNode.name === 'Archivos Drive' }}"}},"type":"n8n-nodes-base.splitInBatches","typeVersion":3,"position":[-3040,-768],"id":"be787d36-bac0-4960-a567-5cc105e36060","name":"Loop Over Items1"},{"parameters":{"content":"## RAG - Consulta","height":496,"width":912,"color":4},"type":"n8n-nodes-base.stickyNote","position":[-1888,-1840],"typeVersion":1,"id":"8050025e-d9e6-4a58-a48e-9c14d881111f","name":"Sticky Note"},{"parameters":{"content":"## RAG - Actualiza archivos","height":976,"width":2448},"type":"n8n-nodes-base.stickyNote","position":[-3488,-1152],"typeVersion":1,"id":"5d872e2f-67f3-434a-b5c3-6f36d5af77f3","name":"Sticky Note1"},{"parameters":{"content":"## RAG - Elimina archivos no usados","height":608,"width":1504,"color":3},"type":"n8n-nodes-base.stickyNote","position":[-3312,48],"typeVersion":1,"id":"53ed0606-12a9-4459-a8e5-dfa766b70072","name":"Sticky Note2"},{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":2.1,"position":[-1552,-1728],"id":"04c088a4-3be1-41a2-9a36-4bafe1e54660","name":"RAG - Agent"},{"parameters":{},"type":"@n8n/n8n-nodes-langchain.memoryPostgresChat","typeVersion":1.3,"position":[-1456,-1504],"id":"847fd24e-3538-4de0-a706-63063681e6da","name":"Chat Memory","credentials":{"postgres":{"id":"RJfYPONKqWUiJzDA","name":"Postgres account"}}},{"parameters":{"operation":"upsert","schema":{"__rl":true,"mode":"list","value":"public"},"table":{"__rl":true,"value":"archivos","mode":"list","cachedResultName":"archivos"},"columns":{"mappingMode":"defineBelow","value":{"id":"={{ $json.id }}","title":"={{ $json.name }}","updated_at":"={{ $json.modifiedTime }}"},"matchingColumns":["id"],"schema":[{"id":"id","displayName":"id","required":true,"defaultMatch":true,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"title","displayName":"title","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":false},{"id":"updated_at","displayName":"updated_at","required":false,"defaultMatch":false,"display":true,"type":"dateTime","canBeUsedToMatch":false},{"id":"created_at","displayName":"created_at","required":false,"defaultMatch":false,"display":true,"type":"dateTime","canBeUsedToMatch":false,"removed":true}],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[-2544,-944],"id":"1a1b388b-5ae4-4db1-b57b-f4155f55156a","name":"Actualiza archivos BD","credentials":{"postgres":{"id":"RJfYPONKqWUiJzDA","name":"Postgres account"}}},{"parameters":{"resource":"fileFolder","queryString":"={{ $json.title }}","returnAll":true,"filter":{"folderId":{"__rl":true,"value":"13QbK_DnnaR-RT_Hm-jjJk63ndhMPj69c","mode":"list","cachedResultName":"conocimiento","cachedResultUrl":"https://drive.google.com/drive/folders/13QbK_DnnaR-RT_Hm-jjJk63ndhMPj69c"}},"options":{}},"type":"n8n-nodes-base.googleDrive","typeVersion":3,"position":[-2736,336],"id":"63034617-a665-41e6-bf7f-3add469a2a46","name":"Busca archivo","alwaysOutputData":true,"credentials":{"googleDriveOAuth2Api":{"id":"i9ySFF086TyukTDr","name":"Google Drive account Bestfranquicias"}}},{"parameters":{"operation":"executeQuery","query":"DELETE FROM documents\nWHERE metadata->>'file_id' = '{{ $('Loop Over Items').item.json.id }}';","options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[-2288,352],"id":"b119ceca-21ca-400b-899c-5ac4b3fe8913","name":"Elimina chunks","credentials":{"postgres":{"id":"RJfYPONKqWUiJzDA","name":"Postgres account"}}},{"parameters":{"operation":"executeQuery","query":"DELETE FROM documents\nWHERE metadata->>'file_id' = '{{ $('If2').item.json.id }}';","options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[-2336,-944],"id":"1d851aed-2e31-45c1-85d8-644fc09671bf","name":"Depura chunks","credentials":{"postgres":{"id":"RJfYPONKqWUiJzDA","name":"Postgres account"}}},{"parameters":{"operation":"deleteTable","schema":{"__rl":true,"mode":"list","value":"public"},"table":{"__rl":true,"value":"archivos","mode":"list","cachedResultName":"archivos"},"deleteCommand":"delete","where":{"values":[{"column":"id","value":"={{ $('Loop Over Items').item.json.id }}"}]},"options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[-2064,352],"id":"2a6c9873-5f7e-41be-a33b-360d61cb2ec8","name":"Elimina archivo BD","credentials":{"postgres":{"id":"RJfYPONKqWUiJzDA","name":"Postgres account"}}}],"connections":{"When chat message received":{"main":[[{"node":"RAG - Agent","type":"main","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"RAG - Agent","type":"ai_languageModel","index":0}]]},"Supabase Vector Store":{"ai_tool":[[{"node":"RAG - Agent","type":"ai_tool","index":0}]]},"Download file":{"main":[[{"node":"Supabase Vector Store1","type":"main","index":0}]]},"Embeddings OpenAI":{"ai_embedding":[[{"node":"Supabase Vector Store1","type":"ai_embedding","index":0},{"node":"Supabase Vector Store","type":"ai_embedding","index":0}]]},"Default Data Loader":{"ai_document":[[{"node":"Supabase Vector Store1","type":"ai_document","index":0}]]},"Recursive Character Text Splitter":{"ai_textSplitter":[[{"node":"Default Data Loader","type":"ai_textSplitter","index":0}]]},"Switch":{"main":[[{"node":"Download file","type":"main","index":0}],[{"node":"Download file","type":"main","index":0}],[{"node":"Download file","type":"main","index":0}]]},"Execute a SQL query":{"main":[[{"node":"Archivos Drive","type":"main","index":0},{"node":"Archivos BD","type":"main","index":0}]]},"Loop Over Items":{"main":[[],[{"node":"Busca archivo","type":"main","index":0}]]},"If":{"main":[[{"node":"Loop Over Items","type":"main","index":0}],[{"node":"Elimina chunks","type":"main","index":0}]]},"Archivos Drive":{"main":[[{"node":"Loop Over Items1","type":"main","index":0}]]},"Archivos BD":{"main":[[{"node":"Loop Over Items","type":"main","index":0}]]},"Schedule Trigger":{"main":[[{"node":"Execute a SQL query","type":"main","index":0}]]},"If2":{"main":[[{"node":"Actualiza archivos BD","type":"main","index":0}],[{"node":"Loop Over Items1","type":"main","index":0}]]},"Loop Over Items1":{"main":[[],[{"node":"If2","type":"main","index":0}]]},"Supabase Vector Store1":{"main":[[{"node":"Loop Over Items1","type":"main","index":0}]]},"Chat Memory":{"ai_memory":[[{"node":"RAG - Agent","type":"ai_memory","index":0}]]},"Actualiza archivos BD":{"main":[[{"node":"Depura chunks","type":"main","index":0}]]},"Busca archivo":{"main":[[{"node":"If","type":"main","index":0}]]},"Elimina chunks":{"main":[[{"node":"Elimina archivo BD","type":"main","index":0}]]},"Depura chunks":{"main":[[{"node":"Switch","type":"main","index":0}]]},"Elimina archivo BD":{"main":[[{"node":"Loop Over Items","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{},"versionId":"a0d84f15-9c21-4fca-8b89-241e83d0ec42","triggerCount":0,"shared":[{"updatedAt":"2025-10-15T10:22:31.322Z","createdAt":"2025-10-15T10:22:31.322Z","role":"workflow:owner","workflowId":"zxtVEgxXnnHyjBlH","projectId":"prlZ3bTXg0wKi0D1"}],"tags":[]}